{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bike App</title>
    <link rel="icon" href="{% static 'favicon.ico' %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link
      rel="stylesheet"
      href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css"
      crossorigin="anonymous"
    />
    {% if mapbox.ACCESS_TOKEN %}
      <script
        id="mapbox-gl-js"
        src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"
        crossorigin="anonymous"
        defer
      ></script>
    {% endif %}
  </head>
  <body>
    <main class="app-shell">
      <section class="side-button-bar" aria-label="주요 기능">
        <div class="side-button-bar__buttons" role="tablist" aria-orientation="vertical">
          <button class="side-button is-active" data-mode="circular" role="tab" aria-selected="true">
            <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="icon">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M22.875,12a4.875,4.875,0,0,1-8.325,3.45q-0.008,0-0.016,-0.017L8.908,9.082a4.125,4.125,0,1,0,0,5.847l0.808,-0.91a0.375,0.375,0,1,1,0.561,0.498l-0.814,0.92q-0.008,0.008,-0.016,0.017a4.875,4.875,0,1,1,0-6.891q0.008,0.008,0.016,0.017l5.628,6.347a4.125,4.125,0,1,0,0-5.847l-0.808,0.91a0.375,0.375,0,1,1-0.561,-0.498l0.814,-0.92q0.008,-0.008,0.016,-0.017A4.875,4.875,0,0,1,22.875,12Z"
              />
            </svg>
            <span class="sr-only">루프 경로</span>
          </button>
          <button class="side-button" data-mode="directions" role="tab" aria-selected="false">
            <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="icon">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span class="sr-only">길찾기</span>
          </button>
          <button class="side-button" data-mode="popularity" role="tab" aria-selected="false">
            <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="icon">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
              />
            </svg>
            <span class="sr-only">인기 경로</span>
          </button>
          <button class="side-button" data-mode="favorites" role="tab" aria-selected="false">
            <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="icon">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11.245 4.174C11.4765 3.50808 11.5922 3.17513 11.7634 3.08285C11.9115 3.00298 12.0898 3.00298 12.238 3.08285C12.4091 3.17513 12.5248 3.50808 12.7563 4.174L14.2866 8.57639C14.3525 8.76592 14.3854 8.86068 14.4448 8.93125C14.4972 8.99359 14.5641 9.04218 14.6396 9.07278C14.725 9.10743 14.8253 9.10947 15.0259 9.11356L19.6857 9.20852C20.3906 9.22288 20.743 9.23007 20.8837 9.36432C21.0054 9.48051 21.0605 9.65014 21.0303 9.81569C20.9955 10.007 20.7146 10.2199 20.1528 10.6459L16.4387 13.4616C16.2788 13.5829 16.1989 13.6435 16.1501 13.7217C16.107 13.7909 16.0815 13.8695 16.0757 13.9507C16.0692 14.0427 16.0982 14.1387 16.1563 14.3308L17.506 18.7919C17.7101 19.4667 17.8122 19.8041 17.728 19.9793C17.6551 20.131 17.5108 20.2358 17.344 20.2583C17.1513 20.2842 16.862 20.0829 16.2833 19.6802L12.4576 17.0181C12.2929 16.9035 12.2106 16.8462 12.1211 16.8239C12.042 16.8043 11.9593 16.8043 11.8803 16.8239C11.7908 16.8462 11.7084 16.9035 11.5437 17.0181L7.71805 19.6802C7.13937 20.0829 6.85003 20.2842 6.65733 20.2583C6.49056 20.2358 6.34626 20.131 6.27337 19.9793C6.18915 19.8041 6.29123 19.4667 6.49538 18.7919L7.84503 14.3308C7.90313 14.1387 7.93218 14.0427 7.92564 13.9507C7.91986 13.8695 7.89432 13.7909 7.85123 13.7217C7.80246 13.6435 7.72251 13.5829 7.56262 13.4616L3.84858 10.6459C3.28678 10.2199 3.00588 10.007 2.97101 9.81569C2.94082 9.65014 2.99594 9.48051 3.11767 9.36432C3.25831 9.23007 3.61074 9.22289 4.31559 9.20852L8.9754 9.11356C9.176 9.10947 9.27631 9.10743 9.36177 9.07278C9.43726 9.04218 9.50414 8.99359 9.55657 8.93125C9.61593 8.86068 9.64887 8.76592 9.71475 8.57639L11.245 4.174Z"
              ></path>
            </svg>
            <span class="sr-only">즐겨찾기</span>
          </button>
          <button class="side-button" data-mode="history" role="tab" aria-selected="false" aria-disabled="true" title="게스트 모드에서는 사용할 수 없어요">
            <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="icon">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="sr-only">주행 기록</span>
          </button>
        </div>
        <div class="side-button-bar__footer">
          <button class="primary-action" type="button">로그인</button>
        </div>
      </section>

      <section class="sidebar" aria-live="polite">
        <div class="sidebar__panels">
          <article class="sidebar-panel is-active" data-mode="circular">
            <div class="panel-head">
              <p class="eyebrow">루프 경로</p>
              <h2>출발지로 돌아오는 코스</h2>
              <p>출발지와 시간을 입력하면 왕복 루트를 생성합니다.</p>
            </div>
            <form class="panel-form" aria-label="루프 경로 생성 폼">
              <label class="form-field">
                <span>현재 위치</span>
                <input type="text" name="loop-start" placeholder="예) 서울시청" value="서울시청" />
              </label>
              <label class="form-field">
                <span>목표 시간 (분)</span>
                <input type="number" name="loop-duration" min="10" max="240" value="30" />
              </label>
            </form>
            <div class="panel-card panel-card--warning" role="status">
              <strong>무료 사용자 안내</strong>
              <p>일일 3회 제한이 적용됩니다. Pro 이상 구독 시 무제한 생성이 가능합니다.</p>
            </div>
              <button type="button" class="btn btn--primary" data-action="generate-loop-route">경로 생성하기</button>
            <p class="hint-text">생성된 경로 정보와 즐겨찾기 버튼은 오른쪽 패널에서 확인할 수 있습니다.</p>
            <div class="panel-card">
              <h3>사용법</h3>
              <ul class="bullet-list">
                <li>지도에서 우클릭 후 “출발”을 선택하면 좌표가 자동 입력됩니다.</li>
                <li>목표 시간을 조정하면 거리·고도 편차를 즉시 재계산합니다.</li>
                <li>완료된 루트는 즐겨찾기로 저장하거나 GPX로 내보낼 수 있습니다.</li>
              </ul>
            </div>
          </article>

          <article class="sidebar-panel" data-mode="directions">
            <div class="panel-head">
              <p class="eyebrow">길찾기</p>
              <h2>이동</h2>
              <p>출발·도착지를 지정하고 우선순위를 선택하세요.</p>
            </div>
            <form class="panel-form" aria-label="길찾기 폼">
              <label class="form-field">
                <span>현재 위치</span>
                <input type="text" name="directions-start" placeholder="출발지를 입력하거나 지도에서 우클릭" />
              </label>
              <label class="form-field">
                <span>도착지</span>
                <input type="text" name="directions-end" placeholder="도착지를 입력하세요" />
              </label>
            </form>
            <div class="option-buttons" role="toolbar" aria-label="경로 옵션">
              <button type="button" class="option-button is-active">최단시간</button>
              <button type="button" class="option-button">최단거리</button>
              <button type="button" class="option-button">자전거도로</button>
            </div>
            <button type="button" class="btn btn--primary">경로 검색</button>
            <div class="panel-card">
              <p class="hint-text">우클릭으로 지정한 마커를 드래그하면 새 좌표에 맞춰 주소가 자동 업데이트됩니다.</p>
            </div>
          </article>

          <article class="sidebar-panel" data-mode="popularity">
            <div class="panel-head">
              <p class="eyebrow">인기 경로</p>
              <h2>주변 라이더 추천</h2>
              <p>위치 기반으로 5km 이내에서 많이 달린 코스를 보여줍니다.</p>
            </div>
            <div class="route-list">
              <article class="route-card">
                <div class="route-card__body">
                  <h3>한강 루프 25K</h3>
                  <p>거리 25km · 예상 1h 10m</p>
                </div>
                <div class="route-card__meta">
                  <span class="tag">안전 시설</span>
                  <button type="button" class="btn btn--ghost">공유</button>
                </div>
              </article>
              <article class="route-card">
                <div class="route-card__body">
                  <h3>북악 스카이웨이</h3>
                  <p>거리 18km · 예상 58m</p>
                </div>
                <div class="route-card__meta">
                  <span class="tag">언덕</span>
                  <button type="button" class="btn btn--ghost">공유</button>
                </div>
              </article>
              <article class="route-card">
                <div class="route-card__body">
                  <h3>과천-의왕 자전거길</h3>
                  <p>거리 32km · 예상 1h 40m</p>
                </div>
                <div class="route-card__meta">
                  <span class="tag">야경</span>
                  <button type="button" class="btn btn--ghost">공유</button>
                </div>
              </article>
            </div>
          </article>

          <article class="sidebar-panel" data-mode="favorites">
            <div class="panel-head">
              <p class="eyebrow">즐겨찾기</p>
              <h2>자주 타는 루트</h2>
              <p>태그와 색상으로 분류하고 동료와 공유하세요.</p>
            </div>
            <div class="route-list" data-favorite-list>
              {% if favorites %}
                {% for favorite in favorites %}
                  <article class="route-card" data-favorite-id="{{ favorite.id }}">
                    <div class="route-card__body">
                      <h3>
                        <button
                          type="button"
                          class="favorite-link"
                          data-action="open-favorite-detail"
                          data-favorite-id="{{ favorite.id }}"
                        >
                          {{ favorite.name }}
                        </button>
                      </h3>
                      <p>
                        {% if favorite.distance_km %}거리 {{ favorite.distance_km|floatformat:2 }}km{% else %}거리 정보 없음{% endif %}
                        {% if favorite.duration_minutes %} · 예상 {{ favorite.duration_minutes }}분{% endif %}
                      </p>
                    </div>
                    <div class="route-card__meta">
                      <span class="tag">#{{ favorite.route_type }}</span>
                      <div class="route-card__actions">
                        <button type="button" class="btn btn--ghost" data-action="share-favorite" data-favorite-id="{{ favorite.id }}">공유</button>
                        <button type="button" class="btn btn--ghost" data-action="delete-favorite" data-favorite-id="{{ favorite.id }}" aria-label="삭제">삭제</button>
                      </div>
                    </div>
                  </article>
                {% endfor %}
              {% else %}
                <p class="hint-text" data-favorite-empty>아직 즐겨찾기 경로가 없습니다. 루프 경로를 생성해 추가해 보세요.</p>
              {% endif %}
            </div>
            <button type="button" class="btn btn--primary" disabled aria-disabled="true">새 루트 추가 (준비 중)</button>
          </article>

          <article class="sidebar-panel" data-mode="history">
            <div class="panel-head">
              <p class="eyebrow">주행 기록</p>
              <h2>지난 라이딩 다시 보기</h2>
              <p>날짜별 기록을 선택하면 지도에 궤적이 표시됩니다.</p>
            </div>
            <div class="history-list" role="list">
              <button type="button" class="history-item" data-history-id="1">
                <strong>한강 라이딩</strong>
                <span>2023-10-26 · 25km</span>
              </button>
              <button type="button" class="history-item" data-history-id="2">
                <strong>북악 스카이웨이</strong>
                <span>2023-10-24 · 18km</span>
              </button>
              <button type="button" class="history-item" data-history-id="3">
                <strong>과천-의왕 자전거길</strong>
                <span>2023-10-22 · 32km</span>
              </button>
            </div>
            <div class="panel-card">
              <p class="hint-text">GPX · FIT 포맷으로 다운로드해 다른 기기에서도 재생할 수 있습니다.</p>
            </div>
          </article>
        </div>
      </section>

      <section class="sidebar sidebar--detail" data-route-detail-panel hidden aria-label="생성된 경로 정보">
        <div class="route-detail">
          <div class="route-detail__header">
            <div>
              <p class="eyebrow">생성된 경로</p>
              <h3 data-route-detail-field="name">루프 경로</h3>
            </div>
            <button type="button" class="detail-close-button" data-action="close-route-detail" aria-label="경로 정보 닫기">
              ×
            </button>
          </div>
          <dl class="route-detail__stats">
            <div>
              <dt>거리</dt>
              <dd data-route-detail-field="distance">-- km</dd>
            </div>
            <div>
              <dt>예상 시간</dt>
              <dd data-route-detail-field="duration">-- 분</dd>
            </div>
            <div>
              <dt>상승고도</dt>
              <dd data-route-detail-field="ascend">-- m</dd>
            </div>
            <div>
              <dt>하강고도</dt>
              <dd data-route-detail-field="descend">-- m</dd>
            </div>
          </dl>
          <p class="hint-text" data-route-detail-field="meta">경로를 생성하면 상세 정보가 표시됩니다.</p>
          <button type="button" class="btn btn--ghost" data-action="save-loop-favorite" data-default-label="즐겨찾기 저장" aria-disabled="true">즐겨찾기 저장</button>
        </div>
      </section>

      <section class="map-area" aria-label="지도 영역">
        <div id="map" aria-label="Mapbox 지도"></div>
        <noscript class="noscript-map-fallback">지도를 확인하려면 JavaScript를 활성화하세요.</noscript>
        <p class="hint-text" role="note">
          Mapbox 스타일 변경 사항은 브라우저 캐시에 따라 최대 24시간 내 반영되며, WebGL 미지원 시 Mapbox GL Supported 안내에 따라 대체 보기를 제공합니다.
        </p>
      </section>
    </main>
    {{ favorites_json|json_script:"favorite-data" }}
    {{ mapbox|json_script:"mapbox-config" }}
    <script src="{% static 'js/app.js' %}" defer></script>
  </body>
</html>
